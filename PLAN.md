# PLAN.md
## Поэтапный план реализации приложения GoNext — Дневник туриста

---

## Этап 0. Подготовка окружения и структуры

1. Убедиться, что минимальное приложение (Expo Router + TypeScript + React Native Paper) запускается.
2. Добавить зависимости: SQLite (expo-sqlite), работа с файлами для фото (expo-file-system, expo-image-picker).
3. Спроектировать структуру папок: `app/`, `components/`, `db/`, `types/`, `hooks/`, `utils/`.
4. Описать TypeScript-типы для сущностей: `Place`, `Trip`, `TripPlace` (в соответствии с PROJECT.md).

---

## Этап 1. База данных и хранение

1. Инициализировать SQLite: создать базу, включить при первом запуске.
2. Реализовать миграции/схему:
   - таблица `places` (id, name, description, visitlater, liked, latitude, longitude, createdAt);
   - таблица `trips` (id, title, description, startDate, endDate, createdAt, current);
   - таблица `trip_places` (id, tripId, placeId, order, visited, visitDate, notes, createdAt);
   - таблица или каталог для привязки фото к местам/поездкам.
3. Реализовать слой доступа к данным (например, `db/places.ts`, `db/trips.ts`, `db/tripPlaces.ts`) с функциями: CRUD для мест, CRUD для поездок, работа с местами в поездке.
4. Определить, где и как хранить файлы фотографий (expo-file-system), и сохранять в БД только пути/идентификаторы.

---

## Этап 2. Навигация и главный экран

1. Настроить Expo Router: главный экран с заголовком «GoNext» и четырьмя кнопками:
   - Места
   - Поездки
   - Следующее место
   - Настройки
2. Создать маршруты (экраны-заглушки): список мест, карточка места, список поездок, детали поездки, следующее место, настройки.
3. Реализовать переходы между экранами (Stack или Tabs по выбору, согласно навигации из PROJECT.md).

---

## Этап 3. Режим «Места»

1. Экран «Список мест»:
   - загрузка мест из БД;
   - отображение списка (React Native Paper List);
   - кнопка «Добавить место».
2. Экран «Добавление/редактирование места»:
   - форма: название, описание, visitlater, liked, координаты (ввод или выбор на карте);
   - сохранение в SQLite.
3. Экран «Детальная карточка места»:
   - показ всех полей;
   - прикрепление фотографий (expo-image-picker, сохранение файла, запись в БД);
   - кнопка «Открыть на карте» (Linking или expo-linking с координатами).
4. Реализовать открытие места на карте (гео-URL или встроенная карта при необходимости).

---

## Этап 4. Режим «Поездки»

1. Экран «Список поездок»:
   - загрузка поездок из БД;
   - отображение списка;
   - кнопка «Создать поездку»;
   - визуально выделить текущую поездку (current).
2. Экран «Создание/редактирование поездки»:
   - поля: title, description, startDate, endDate;
   - переключатель/флаг «Текущая поездка» (current);
   - сохранение в SQLite.
3. Экран «Детали поездки (маршрут)»:
   - список мест поездки (TripPlace) в порядке `order`;
   - добавление мест из списка мест или создание нового;
   - изменение порядка (перетаскивание или кнопки вверх/вниз);
   - отметка места как посещённого (visited, visitDate);
   - добавление заметок и фотографий к посещённому месту;
   - отображение поездки и как плана, и как дневника (по датам и visited).
4. Логика единственной текущей поездки: при установке current = true для одной поездки сбрасывать current у остальных.

---

## Этап 5. Режим «Следующее место»

1. Экран «Следующее место»:
   - запрос к БД: выбрать поездку с current = true;
   - из её мест выбрать первое с visited = false;
   - если такого нет — показать сообщение («Нет следующего места» или «Все места посещены»).
2. Отображение информации о следующем месте (название, описание, координаты).
3. Кнопки:
   - «Открыть на карте» (гео-ссылка или карта);
   - «Открыть в навигаторе» (Google Maps / Apple Maps через Linking с координатами).

---

## Этап 6. Настройки и доработки

1. Экран «Настройки»:
   - минимальный набор опций (например, о приложении, сброс данных — по желанию);
   - при необходимости — настройки уведомлений или единиц измерения.
2. Обработка отсутствия текущей поездки: корректное отображение на экране «Следующее место» и в навигации.
3. Проверка офлайн-сценария: приложение не запрашивает сеть для основных функций.
4. Тестирование на Android и iOS (Expo Go или dev build): списки, формы, БД, фото, переходы по ссылкам.

---

## Этап 7. Финализация MVP

1. Проверка соответствия PROJECT.md: все сущности, поля и возможности режимов реализованы.
2. Устранение критичных багов и улучшение UX (загрузки, пустые состояния, сообщения об ошибках).
3. При необходимости — краткое обновление README с инструкцией по запуску и описанием экранов.

---

## Порядок этапов (кратко)

| № | Этап | Содержание |
|---|------|------------|
| 0 | Подготовка | Зависимости, структура проекта, типы |
| 1 | База данных | SQLite, схема, слой доступа, хранение фото |
| 2 | Навигация | Главный экран, маршруты, переходы |
| 3 | Места | Список, добавление/редактирование, карточка, фото, карта |
| 4 | Поездки | Список, создание/редактирование, маршрут, порядок, посещения |
| 5 | Следующее место | Выбор следующего, карта, навигатор |
| 6 | Настройки | Экран настроек, офлайн, тесты |
| 7 | Финализация | Соответствие PROJECT.md, баги, README |
